<!DOCTYPE html>
<html data-bs-theme="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>adminApproval</title>
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="/adminApprovalAssets/css/styles.min.css"/>
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"
    />
</head>

<body
        style="
            width: 100%;
            filter: brightness(100%);
            text-align: center;
            height: 100%;
        "
        href="/"
>
<nav
        class="navbar navbar-expand-md py-3"
        style="
			--bs-body-bg: rgb(109, 24, 106);
			background: var(--bs-white);
			border-bottom-color: var(--bs-danger-border-subtle);
			box-shadow: 8px -6px 20px, 0px 0px 12px var(--bs-border-color);
			width: 100%;
		"
>
    <div class="container">
        <a
                class="navbar-brand d-flex align-items-center"
                href="/admin/dashboard"
                style="color: var(--bs-success-text-emphasis)"
        ><span
                    class="bs-icon-sm bs-icon-rounded bs-icon-primary d-flex justify-content-center align-items-center me-2 bs-icon"
            ><svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="1em"
                        height="1em"
                        fill="currentColor"
                        viewBox="0 0 16 16"
                        class="bi bi-bezier"
                        data-bss-hover-animate="jello"
                >
						<path
                                fill-rule="evenodd"
                                d="M0 10.5A1.5 1.5 0 0 1 1.5 9h1A1.5 1.5 0 0 1 4 10.5v1A1.5 1.5 0 0 1 2.5 13h-1A1.5 1.5 0 0 1 0 11.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zm10.5.5A1.5 1.5 0 0 1 13.5 9h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM6 4.5A1.5 1.5 0 0 1 7.5 3h1A1.5 1.5 0 0 1 10 4.5v1A1.5 1.5 0 0 1 8.5 7h-1A1.5 1.5 0 0 1 6 5.5v-1zM7.5 4a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1z"
                        ></path>
						<path
                                d="M6 4.5H1.866a1 1 0 1 0 0 1h2.668A6.517 6.517 0 0 0 1.814 9H2.5c.123 0 .244.015.358.043a5.517 5.517 0 0 1 3.185-3.185A1.503 1.503 0 0 1 6 5.5v-1zm3.957 1.358A1.5 1.5 0 0 0 10 5.5v-1h4.134a1 1 0 1 1 0 1h-2.668a6.517 6.517 0 0 1 2.72 3.5H13.5c-.123 0-.243.015-.358.043a5.517 5.517 0 0 0-3.185-3.185z"
                        ></path></svg></span
            ><span
                    data-bss-hover-animate="pulse"
                    style="font-size: 20px; text-align: center"
            >IUT Traffic Record Management System</span
            ></a
        >
        <button
                data-bs-toggle="collapse"
                class="navbar-toggler"
                data-bs-target="#navcol-2"
        >
				<span class="visually-hidden">Toggle navigation</span
                ><span class="navbar-toggler-icon"></span>
        </button>
        <div
                class="collapse navbar-collapse"
                id="navcol-2"
                style="margin-right: -77px"
        >
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a
                            class="nav-link"
                            data-bss-hover-animate="pulse"
                            id="pending_request"
                            href="/admin/dashboard"
                            style="
							padding-left: 52px;
							--bs-body-font-size: -14rem;
							font-size: 20px;
							text-shadow: 0px 0px 1px;
							color: var(--bs-emphasis-color);
						"
                    ><span style="color: rgb(10, 54, 34)"
                        >Dashboard</span
                        ></a
                    >
                </li>
                <li class="nav-item">
                    <a
                            class="nav-link active"
                            data-bss-hover-animate="pulse"
                            id="view_logs"
                            href="/admin/view-vehicle-logs"
                            style="
								padding-left: 52px;
								--bs-body-font-size: -14rem;
								font-size: 20px;
								text-shadow: 0px 0px 1px;
								color: var(--bs-emphasis-color);
							"
                    ><span style="color: rgb(10, 54, 34)"
                        >View Logs</span
                        ></a
                    >
                </li>
                <% if (appUser.designation === "SCO") { %>
                    <li class="nav-item">
                        <a
                                class="nav-link"
                                data-bss-hover-animate="pulse"
                                id="pending_request"
                                href="/admin/generate-report"
                                style="
								padding-left: 52px;
								--bs-body-font-size: -14rem;
								font-size: 20px;
								text-shadow: 0px 0px 1px;
								color: var(--bs-emphasis-color);
							"
                        ><span style="color: rgb(10, 54, 34)"
                            >Report</span
                            ></a
                        >
                    </li>

                <% } %>
                <li class="nav-item">
                    <a
                            class="nav-link"
                            data-bss-hover-animate="pulse"
                            id="VehicleList"
                            href="/admin/user-vehicle-list"
                            style="
								padding-left: 52px;
								--bs-body-font-size: -14rem;
								font-size: 20px;
								text-shadow: 0px 0px 1px;
								color: var(--bs-emphasis-color);
							"
                    ><span style="color: rgb(10, 54, 34)"
                        >Vehicles</span
                        ></a
                    >
                </li>
                <li class="nav-item">
                    <a
                            class="nav-link"
                            data-bss-hover-animate="pulse"
                            id="logout"
                            href="/logout"
                            style="
								padding-left: 52px;
								--bs-body-font-size: -14rem;
								font-size: 20px;
								text-shadow: 0px 0px 1px;
								color: var(--bs-emphasis-color);
							"
                    ><span style="color: rgb(10, 54, 34)"
                        >Logout</span
                        ></a
                    >
                </li>
                <li class="nav-item">
                    <a
                            class="nav-link"
                            data-bss-hover-animate="pulse"
                            id="logout"
                            href="#"
                            style="
								padding-left: 52px;
								--bs-body-font-size: -14rem;
								font-size: 20px;
								text-shadow: 0px 0px 1px;
								color: var(--bs-emphasis-color);
							"
                    ><span style="color: rgb(10, 54, 34)"
                        ><%= appUser.name; %>(<%= appUser.designation %>)</span
                        ></a
                    >
                </li>
            </ul>
        </div>
    </div>
</nav>

<% for (const err of error) { %>
    <div class="alert alert-danger" role="alert"
         style="margin-top: 2%;margin-left: 25%;margin-right: 25%;width: 50%;display: flex;justify-content: space-between;">
        <strong><%= err; %></strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
<% } %>
<% for (const message of success) { %>
    <div class="alert alert-success" role="alert"
         style="margin-top: 2%;margin-left: 25%;margin-right: 25%;width: 50%;display: flex;justify-content: space-between;">
        <strong><%= message; %></strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
<% } %>

<div style="display: block; margin: 0px; margin-top: 30px">
    <div style="display: flex">
        <input
                type="search"
                style="
                        margin-right: 0px;
                        margin-left: 504px;
                        width: 350px;
                        height: 35.9091px;
                    "
                placeholder="License Number or User ID"
        /><input
                class="btn btn-primary"
                type="submit"
                value="search"
                style="margin-left: 10px"
        />
    </div>
    <% let vehicles = []; %>
    <form action="/admin/get-approval" method="post">
        <div style="margin-right: 0px">

            <button
                    class="btn btn-primary"
                    id="approveButton"
                    type="submit"
                    style="
                            margin-top: 20px;
                            margin-left: 100px;
                            background: rgb(27, 66, 123);
                        "
                    name="action"
                    value="approve"
            >
                Approve All
            </button>

            <% vehicles.push("adadawd"); %>
            <button
                    class="btn btn-primary"
                    id="rejectButton"
                    type="submit"
                    style="
                            margin-top: 20px;
                            margin-left: 10px;
                            background: rgb(27, 66, 123);
                        "
                    name="action"
                    value="reject"
            >
                Reject All
            </button>
        </div>
        <div
                class="table-responsive fw-semibold text-start"
                style="
                        margin-top: 2%;
                        width: 90%;
                        margin-right: 10%;
                        margin-left: 5%;
                        box-shadow: 0px 0px 9px;
                        border-radius: 12px;
                        height: 90%;
                        background: var(--bs-btn-hover-color);
                    "
        >

            <table hidden>
                <tbody>
                <% for (const vehicle of vehicleInfo) { %>
                    <tr>
                        <td><%= vehicle.userName %></td>
                        <td><%= vehicle.userId %></td>
                        <td><%= vehicle.licenseNumber %></td>
                    </tr>
                <% } %>
                </tbody>
            </table>

            <table class="table">


                </tbody>
            </table>
        </div>
    </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/adminApprovalAssets/js/script.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
<script>
	let fuse;
	const vehicles = [];

	document.addEventListener("DOMContentLoaded", () => {
		const table = document.querySelector("table[hidden]");
		for (const row of table.rows) {
			const cell = row.cells;
			vehicles.push({
				userName: cell[0].innerText,
				userId: cell[1].innerText,
				licenseNumber: cell[2].innerText,
			});
		}

		fuse = new Fuse(vehicles, {
			keys: ["userName", "userId", "licenseNumber"],
		});
		showResults(vehicles);
	});

	document.querySelector("input[type=search]").addEventListener("input", (e) => {
		const info = search(e.target.value);
		showResults(info);
	});

	function search(text) {
		if (text.length > 0) {
			const results = fuse.search(text);
			return results.map((result) => result.item);
		}
		return vehicles;
	}

	function showResults(info) {
		const table = document.querySelector("table[class=table]");
		let content = `
		 <thead style="width: 80%; padding: 0px">
                <tr style="width: 80%; height: 57.5px">
                    <th
                            style="
                                        box-shadow: 0px 0px 5px 0px;
                                        border-style: solid;
                                        width: 20%;
                                    "
                    >
                        <div
                                class="form-check"
                                style="
                                    margin: 0px;
                                    margin-left: 5px;
                                    margin-right: 0px;
                                    margin-top: 3px;
                                "
                        >
                            <input
                                    class="form-check-input"
                                    type="checkbox"
                                    id="formcheck-2"
                                    style="font-size: 20px; border: 1px solid black;"
                                    onclick="checkAllStatus(this)"
                            /><label
                                    class="form-check-label"
                                    for="formcheck-2"
                                    style="height: 23px; font-size: 21px"
                            >select all</label
                            >
                        </div>
                    </th>
                    <th
                            style="
                                        box-shadow: 0px 0px 5px 0px;
                                        border-style: solid;
                                        width: 20%;
                                    "
                    >
                        owner name
                    </th>
                    <th
                            style="
                                        box-shadow: 0px 0px 5px 0px;
                                        border-style: solid;
                                        width: 15%;
                                    "
                    >
                        owner id
                    </th>
                    <th
                            style="
                                        box-shadow: 0px 0px 5px 0px;
                                        border-style: solid;
                                        width: 15%;
                                    "
                    >
                        license number
                    </th>
                    <th
                            style="
                                        box-shadow: 0px 0px 5px 0px;
                                        width: 5%;
                                        text-align: center;
                                    "
                    >
                        action
                    </th>
                </tr>
                </thead>
                <tbody style="width: 80%; height: initial">`;

		let i = 1;
		for (const vehicle of info) {
			content += `
		        <tr
		                style="
		                        margin-right: 19px;
		                        margin-top: 0px;
		                        margin-left: -2px;
		                    "
		        >
		            <td style="box-shadow: 0px 0px 5px 0px">
		                <div class="form-check">
		                    <input
		                            class="form-check-input"
		                            type="checkbox"
		                            id="formCheck${i}"
		                            name="formCheck"
		                            style="font-size: 15px; border: 1px solid black;
		                                       margin-top: 10px;
		                                      "
		                            value="${vehicle.licenseNumber}"
		                            onclick="checkIndividualStatus()"
		                    /><label
		                            class="form-check-label"
		                            style="
		                                        margin-left: 5px;
		                                        margin-top: 2px;
		                                        font-size: 20px;
		                                      "
		                            for="formCheck-${i}"
		                    >${i}</label
		                    >
		                </div>
		            </td>
		            <td
		                    id="ownerName"
		                    style="box-shadow: 0px 0px 5px 0px"
		                    name="userName"
		            >
		                ${vehicle.userName}
		            </td>
		            <td
		                    id="ownerId"
		                    style="box-shadow: 0px 0px 5px 0px"
		                    name="userId"
		            >
		                <a style="color: var(--bs-danger-text-emphasis)"
		                   href="/admin/view-user-details/${vehicle.userId}">${vehicle.userId}</a>
		            </td>
		            <td
		                    id="licenseNumber"
		                    style="box-shadow: 0px 0px 5px 0px"
		                    name="licenseNumber"
		            >
		                <a style="color: var(--bs-danger-text-emphasis)"
		                   href="/view-vehicle-details/${vehicle.licenseNumber}"
		                >${vehicle.licenseNumber}</a
		                >
		            </td>
		            <td
		                    style="
		                            box-shadow: 0px 0px 5px 0px;
		                            text-align: center;
		                            display: inline-flex;
		                        "
		            >

                    <a style="margin-right: 5px" class="btn btn-primary" href="/admin/approve/${vehicle.licenseNumber}">Approve</a>
                    <a class="btn btn-primary" href="/admin/reject/${vehicle.licenseNumber}">Reject</a>
		            </td>
		        </tr>`;
			i++;
		}

		content += "</tbody>";
		table.innerHTML = content;
		console.log(content);
		console.log("innerHTML", table.innerHTML);
	}

	function checkAllStatus(element) {
		const checkboxes = document.getElementsByName('formCheck');
		for (const checkbox of checkboxes) {
			checkbox.checked = element.checked;
		}
	}

	function checkIndividualStatus() {
		const checkboxes = document.getElementsByName('formCheck');
		let allChecked = true;
		for (const checkbox of checkboxes) {
			if (!checkbox.checked) {
				allChecked = false;
				break;
			}
		}

		document.getElementById('formcheck-2').checked = allChecked;
	}

	// approve button
	document.getElementById('approveButton').addEventListener('click', function () {
		var checkboxes = document.getElementsByName('formCheck');
		var checked = false;
		for (var i = 0; i < checkboxes.length; i++) {
			if (checkboxes[i].checked) {
				checked = true;
				vehicles.push(checkboxes[i].value);
			}
		}
		if (!checked) {
			alert('Please select at least one checkbox');
		} else {

			document.getElementById('approveButton').type = 'submit';
		}
	});

	// reject button
	document.getElementById('rejectButton').addEventListener('click', function () {
		var checkboxes = document.getElementsByName('formCheck');
		var checked = false;
		for (var i = 0; i < checkboxes.length; i++) {
			if (checkboxes[i].checked) {
				checked = true;
				vehicles.push(checkboxes[i].value);
			}
		}
		if (!checked) {
			alert('Please select at least one checkbox');
		} else {
			document.getElementById('rejectButton').type = 'submit';
		}
	});
</script>
</body>
</html>